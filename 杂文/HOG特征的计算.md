
方向梯度直方图（Histogram of Oriented Gradient, HOG）特征是一种在计算机视觉和图像处理中用来进行物体检测的特征描述子。它通过计算和统计图像局部区域的梯度方向直方图来构成特征。HOG 特征检测算法的几个步骤：颜色空间归一化、梯度计算、梯度方向直方图、重叠块直方图归一化、HOG特征。下面分别对其进行介绍。

## 1 颜色空间归一化

由于图像的采集环境、装置等因素，采集到的人脸图像效果可能不是很好，容易出现误检或漏检的情况，所以需要对采集到的人脸进行图像预处理，主要是处理光线太暗或太强的情况，这里有两次处理：图像灰度化、Gamma校正。

### 1.1 图像灰度化

对于彩色图像，将 RGB 分量转化成灰度图像，其转化公式为：

$$
Gray = 0.3 R + 0.59 G + 0.11 B
$$

### 1.2 Gamma 校正

在图像照度不均匀的情况下，可以通过 Gamma 校正，将图像整体亮度提高或降低。在实际中可以采用两种不同的方式进行 Gamma 标准化，平方根、对数法。这里我们采用平方根的办法，公式如下（其中 $\gamma =0.5$）：

$$
Y(x,y) = I(x,y)^{\gamma}
$$

其中 $I(x,y)$ 表示检测窗口在像素点 $(x,y)$ 处的灰度值，$Y(x,y)$ 表示  Gamma 校正后的灰度值。

## 2 梯度计算

对经过颜色空间归一化后的图像，求取其梯度及梯度方向。分别在水平和垂直方向进行计算，梯度算子为：

- 水平方向：$[-1, 0, 1]$
- 垂直方向：$[-1, 0, 1]^T$

$$
\begin{aligned}
&G_x(x,y) = I(x+1,y) - I(x-1,y)\\
&G_y(x,y) = I(x,y+1) - I(x,y-1)\\
&G(x,y) = \sqrt{G_x(x,y)^2 + G_y(x,y)^2}\\
&\theta(x,y) = \text{argtan} (\frac{G_y(x,y)}{G_x(x,y)})
\end{aligned}
$$

其中 $G_x(x,y), G_y(x,y)$ 分别是图像在像素点 $(x,y)$ 处的水平和垂直梯度值。$G(x,y)$ 为像素点 $(x,y)$ 的梯度的模长大小 (梯度幅值)，$\theta(x,y)$ 则指的是像素点 $(x,y)$ 的方向。

## 3 构建方向的直方图

为图像的每个细胞单元构建梯度方向直方图。细胞单元中的每一个像素点都为某个基于方向的直方图通道（orientation-based histogram channel）投票。投票是采取加权投票（weighted voting）的方式，即每一票都是带权值的，这个权值是根据该像素点的梯度幅度计算出来。可以采用幅值本身或者它的函数来表示这个权值，实际测试表明： 使用幅值来表示权值能获得最佳的效果，当然，也可以选择幅值的函数来表示，比如幅值的平方根（square root）、幅值的平方（square of the gradient magnitude）、幅值的截断形式（clipped version of the magnitude）等。细胞单元可以是矩形的（rectangular），也可以是星形的（radial）。直方图通道是平均分布在 $0\sim 180$ 度（无 向）或 $0\sim 360$ 度（有向）范围内。采用无向的梯度和 $9$ 个直方图通道，能在行人检测试验中取得最佳的效果。